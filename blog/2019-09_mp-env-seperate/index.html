<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=Mrn4dXO3Z_939geeswIgr2wIpspT6n7X5cX1Tjp69Ko name=google-site-verification> <base href=/ > <link href=global.css rel=stylesheet> <link href=main.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=atom-one-light.min.css rel=stylesheet> <script async src=//unpkg.com/valine/dist/Valine.min.js></script> <script async src=https://unpkg.com/ajax-hook@2.0.3/dist/ajaxhook.min.js></script> <link href=client/main.3202803961.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>分离小程序环境-GzhiYi's blog</title><meta content=官方文档很模糊，搜索到了几条关于小程序环境分离的问题，大部分吐槽官方怎么没有一个好的办法分离开发和生产环境。 name=description><meta content=小程序,环境,分离,云开发 name=keywords><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <nav class=svelte-1wr5yce><ul class=svelte-1wr5yce> <li class=svelte-1wr5yce><a aria-current=blog class=svelte-1wr5yce href=/ rel=prefetch>blog</a></ul></nav> <main class=svelte-iwmse4> <div class="svelte-1hcu46h content"><h1>分离小程序环境</h1> <p class="svelte-1hcu46h desc">9/8/2019 <span class="svelte-1hcu46h label">小程序</span></p> <p>官方文档很模糊，搜索到了几条关于小程序环境分离的问题，大部分吐槽官方怎么没有一个好的办法分离开发和生产环境。</p> <h2 id=分离方式>分离方式</h2> <ol> <li>云函数在调用的时候指定环境，依据云函数所在的环境进行动态设置。</li> </ol> <pre><code class=language-javascript><span class=hljs-keyword>const</span> wxContext = cloud.getWXContext()
  cloud.updateConfig({
    <span class=hljs-attr>env</span>: wxContext.ENV
  })
  <span class=hljs-comment>// 初始化数据库</span>
  <span class=hljs-keyword>const</span> db = cloud.database({
    <span class=hljs-attr>env</span>: wxContext.ENV
  })</code></pre> <ol start=2> <li>小程序端起到起立环境的主要作用。在appjs中。</li> </ol> <pre><code class=language-javascript>     wx.cloud.init({
        <span class=hljs-attr>traceUser</span>: <span class=hljs-literal>true</span>,
        <span class=hljs-attr>env</span>: <span class=hljs-string>'release-wifo3'</span>, <span class=hljs-comment>// 测试环境</span>
        <span class=hljs-comment>// env: 'dandan-zdm86' // 正式环境</span>
      })</code></pre> <p>预览小程序的时候开启测试环境的env，在部署上线发布的时候再切换为正式环境。</p> </div> <div class=my-8 id=vcomments></div> </main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"2019-09\u002Fmp-env-seperate.md",path:"2019-09\u002Fmp-env-seperate",slug:"2019-09_mp-env-seperate",html:"\u003Cp\u003E官方文档很模糊，搜索到了几条关于小程序环境分离的问题，大部分吐槽官方怎么没有一个好的办法分离开发和生产环境。\u003C\u002Fp\u003E\n\u003Ch2 id=\"分离方式\"\u003E分离方式\u003C\u002Fh2\u003E\n\u003Col\u003E\n\u003Cli\u003E云函数在调用的时候指定环境，依据云函数所在的环境进行动态设置。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E wxContext = cloud.getWXContext()\n  cloud.updateConfig({\n    \u003Cspan class=\"hljs-attr\"\u003Eenv\u003C\u002Fspan\u003E: wxContext.ENV\n  })\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 初始化数据库\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E db = cloud.database({\n    \u003Cspan class=\"hljs-attr\"\u003Eenv\u003C\u002Fspan\u003E: wxContext.ENV\n  })\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Col start=\"2\"\u003E\n\u003Cli\u003E小程序端起到起立环境的主要作用。在appjs中。\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E     wx.cloud.init({\n        \u003Cspan class=\"hljs-attr\"\u003EtraceUser\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E,\n        \u003Cspan class=\"hljs-attr\"\u003Eenv\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E'release-wifo3'\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 测试环境\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F env: 'dandan-zdm86' \u002F\u002F 正式环境\u003C\u002Fspan\u003E\n      })\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E预览小程序的时候开启测试环境的env，在部署上线发布的时候再切换为正式环境。\u003C\u002Fp\u003E\n",fmData:{attributes:{title:"分离小程序环境",description:"官方文档很模糊，搜索到了几条关于小程序环境分离的问题，大部分吐槽官方怎么没有一个好的办法分离开发和生产环境。",keywords:"小程序,环境,分离,云开发",labels:["小程序"],date:"2019-09-08T00:00:00.000Z"},body:"官方文档很模糊，搜索到了几条关于小程序环境分离的问题，大部分吐槽官方怎么没有一个好的办法分离开发和生产环境。\n\n## 分离方式\n\n1. 云函数在调用的时候指定环境，依据云函数所在的环境进行动态设置。\n\n```javascript\nconst wxContext = cloud.getWXContext()\n  cloud.updateConfig({\n    env: wxContext.ENV\n  })\n  \u002F\u002F 初始化数据库\n  const db = cloud.database({\n    env: wxContext.ENV\n  })\n```\n\n2. 小程序端起到起立环境的主要作用。在appjs中。\n\n```javascript\n     wx.cloud.init({\n        traceUser: true,\n        env: 'release-wifo3', \u002F\u002F 测试环境\n        \u002F\u002F env: 'dandan-zdm86' \u002F\u002F 正式环境\n      })\n```\n预览小程序的时候开启测试环境的env，在部署上线发布的时候再切换为正式环境。",bodyBegin:9,frontmatter:"title: 分离小程序环境\ndescription: 官方文档很模糊，搜索到了几条关于小程序环境分离的问题，大部分吐槽官方怎么没有一个好的办法分离开发和生产环境。\nkeywords: 小程序,环境,分离,云开发\nlabels: ['小程序']\ndate: 2019-09-08"}}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.19b6d283.js"}catch(e){main="/client/legacy/client.4e6474e3.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170295070-1"></script> <script> window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-170295070-1'); </script> 