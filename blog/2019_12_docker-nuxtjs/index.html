<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=Mrn4dXO3Z_939geeswIgr2wIpspT6n7X5cX1Tjp69Ko name=google-site-verification> <base href=/ > <link href=global.css rel=stylesheet> <link href=main.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=atom-one-light.min.css rel=stylesheet> <script src=//unpkg.com/valine/dist/Valine.min.js></script> <script src=https://unpkg.com/ajax-hook@2.0.3/dist/ajaxhook.min.js></script> <link href=client/main.1029972362.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>Docker部署nuxtjs应用-GzhiYi's Blog</title><meta content=有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。 name=description><meta content=docker,nuxtjs,ssr name=keywords><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <nav class=svelte-1wr5yce><ul class=svelte-1wr5yce> <li class=svelte-1wr5yce><a aria-current=blog class=svelte-1wr5yce href=/ rel=prefetch>blog</a></ul></nav> <main class=svelte-iwmse4> <div class="svelte-mzxg2z content"><h1>Docker部署nuxtjs应用</h1> <p class="svelte-mzxg2z desc">12/25/2019 <span class="svelte-mzxg2z label">前端</span></p> <p>有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。</p> <h2 id=dockerfile>Dockerfile</h2> <p>通过dockerfile可以build一个docker镜像。dockerfile内容如下：</p> <pre><code class=language-dockerfile><span class=hljs-keyword>FROM</span> node:<span class=hljs-number>11.13</span>.<span class=hljs-number>0</span>-alpine

<span class=hljs-comment># create destination directory</span>
<span class=hljs-keyword>RUN</span><span class=bash> mkdir -p /app</span>
<span class=hljs-keyword>WORKDIR</span><span class=bash> /app</span>

<span class=hljs-comment># copy the app, note .dockerignore</span>
<span class=hljs-keyword>COPY</span><span class=bash> . /app</span>
<span class=hljs-keyword>RUN</span><span class=bash> npm install</span>

<span class=hljs-comment># build necessary, even if no static files are needed,</span>
<span class=hljs-comment># since it builds the server as well</span>
<span class=hljs-keyword>RUN</span><span class=bash> npm run build</span>

<span class=hljs-comment># expose 3000 on container</span>
<span class=hljs-keyword>EXPOSE</span> <span class=hljs-number>3000</span>

<span class=hljs-comment># set app serving to permissive / assigned</span>
<span class=hljs-keyword>ENV</span> NUXT_HOST=<span class=hljs-number>0.0</span>.<span class=hljs-number>0.0</span>
<span class=hljs-comment># set app port</span>
<span class=hljs-keyword>ENV</span> NUXT_PORT=<span class=hljs-number>3000</span>

<span class=hljs-comment># start the app</span>
<span class=hljs-keyword>CMD</span><span class=bash> [ <span class=hljs-string>"npm"</span>, <span class=hljs-string>"start"</span> ]</span></code></pre> <p>注意：</p> <ol> <li>部署 Nuxt.js 服务端渲染的应用不能直接使用 nuxt 命令，而应该先进行编译构建，然后再启动 Nuxt 服务。</li> <li>在build之前，需要ignore以下三个规则文件（手动创建.dockerignore文件）：</li> </ol> <pre><code>node_modules
npm-debug*
.nuxt</code></pre> <p>否则会出现镜像build失败的情况。</p> <p>运行命令：docker run -it -d -p 3000:3000 gzhiyi/nuxt-homepage 后面为镜像build后的名称，注意按实际情况进行更改。</p> <h2 id=nginx配置>nginx配置</h2> <p>Docker运行node服务，如果需要外部访问的话，需要nginx反向代理。具体配置：</p> <pre><code class=language-nginx><span class=hljs-section>server</span> {
    <span class=hljs-attribute>listen</span> <span class=hljs-number>80</span>;
    <span class=hljs-attribute>server_name</span> *your servername*;
    <span class=hljs-attribute>location</span> / {
        <span class=hljs-attribute>proxy_pass</span> http://localhost:3000;
        <span class=hljs-attribute>proxy_http_version</span> <span class=hljs-number>1</span>.<span class=hljs-number>1</span>;
        <span class=hljs-attribute>proxy_set_header</span> Upgrade <span class=hljs-variable>$http_upgrade</span>;
        <span class=hljs-attribute>proxy_set_header</span> Connection <span class=hljs-string>'upgrade'</span>;
        <span class=hljs-attribute>proxy_set_header</span> Host <span class=hljs-variable>$host</span>;
        <span class=hljs-attribute>proxy_cache_bypass</span> <span class=hljs-variable>$http_upgrade</span>;
    }
}</code></pre> <h2 id=访问>访问</h2> <p>需要配置host才能访问，如下：</p> <pre><code class=language-hosts>*your serverip* *your servername*</code></pre> </div> <div class=my-8 id=vcomments></div> </main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"2019\u002F12\u002Fdocker-nuxtjs.md",path:"2019\u002F12\u002Fdocker-nuxtjs",slug:"2019_12_docker-nuxtjs",html:"\u003Cp\u003E有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。\u003C\u002Fp\u003E\n\u003Ch2 id=\"dockerfile\"\u003EDockerfile\u003C\u002Fh2\u003E\n\u003Cp\u003E通过dockerfile可以build一个docker镜像。dockerfile内容如下：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"hljs-keyword\"\u003EFROM\u003C\u002Fspan\u003E node:\u003Cspan class=\"hljs-number\"\u003E11.13\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E-alpine\n\n\u003Cspan class=\"hljs-comment\"\u003E# create destination directory\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003ERUN\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E mkdir -p \u002Fapp\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003EWORKDIR\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E \u002Fapp\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-comment\"\u003E# copy the app, note .dockerignore\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003ECOPY\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E . \u002Fapp\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003ERUN\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E npm install\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-comment\"\u003E# build necessary, even if no static files are needed,\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E# since it builds the server as well\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003ERUN\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E npm run build\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-comment\"\u003E# expose 3000 on container\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003EEXPOSE\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E3000\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-comment\"\u003E# set app serving to permissive \u002F assigned\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003EENV\u003C\u002Fspan\u003E NUXT_HOST=\u003Cspan class=\"hljs-number\"\u003E0.0\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-number\"\u003E0.0\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E# set app port\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003EENV\u003C\u002Fspan\u003E NUXT_PORT=\u003Cspan class=\"hljs-number\"\u003E3000\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-comment\"\u003E# start the app\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003ECMD\u003C\u002Fspan\u003E\u003Cspan class=\"bash\"\u003E [ \u003Cspan class=\"hljs-string\"\u003E\"npm\"\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E\"start\"\u003C\u002Fspan\u003E ]\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E注意：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E部署 Nuxt.js 服务端渲染的应用不能直接使用 nuxt 命令，而应该先进行编译构建，然后再启动 Nuxt 服务。\u003C\u002Fli\u003E\n\u003Cli\u003E在build之前，需要ignore以下三个规则文件（手动创建.dockerignore文件）：\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre\u003E\u003Ccode\u003Enode_modules\nnpm-debug*\n.nuxt\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E否则会出现镜像build失败的情况。\u003C\u002Fp\u003E\n\u003Cp\u003E运行命令：docker run -it -d -p 3000:3000 gzhiyi\u002Fnuxt-homepage  后面为镜像build后的名称，注意按实际情况进行更改。\u003C\u002Fp\u003E\n\u003Ch2 id=\"nginx配置\"\u003Enginx配置\u003C\u002Fh2\u003E\n\u003Cp\u003EDocker运行node服务，如果需要外部访问的话，需要nginx反向代理。具体配置：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-nginx\"\u003E\u003Cspan class=\"hljs-section\"\u003Eserver\u003C\u002Fspan\u003E {\n    \u003Cspan class=\"hljs-attribute\"\u003Elisten\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E80\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-attribute\"\u003Eserver_name\u003C\u002Fspan\u003E *your servername*;\n    \u003Cspan class=\"hljs-attribute\"\u003Elocation\u003C\u002Fspan\u003E \u002F {\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_pass\u003C\u002Fspan\u003E http:\u002F\u002Flocalhost:3000;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_http_version\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_set_header\u003C\u002Fspan\u003E Upgrade \u003Cspan class=\"hljs-variable\"\u003E$http_upgrade\u003C\u002Fspan\u003E;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_set_header\u003C\u002Fspan\u003E Connection \u003Cspan class=\"hljs-string\"\u003E'upgrade'\u003C\u002Fspan\u003E;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_set_header\u003C\u002Fspan\u003E Host \u003Cspan class=\"hljs-variable\"\u003E$host\u003C\u002Fspan\u003E;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_cache_bypass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-variable\"\u003E$http_upgrade\u003C\u002Fspan\u003E;\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"访问\"\u003E访问\u003C\u002Fh2\u003E\n\u003Cp\u003E需要配置host才能访问，如下：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-hosts\"\u003E*your serverip* *your servername*\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n",fmData:{attributes:{title:"Docker部署nuxtjs应用",description:"有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。",keywords:"docker,nuxtjs,ssr",labels:["前端"],date:"2019-12-25T00:00:00.000Z"},body:"有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。\n\n## Dockerfile\n\n通过dockerfile可以build一个docker镜像。dockerfile内容如下：\n```dockerfile\nFROM node:11.13.0-alpine\n\n# create destination directory\nRUN mkdir -p \u002Fapp\nWORKDIR \u002Fapp\n\n# copy the app, note .dockerignore\nCOPY . \u002Fapp\nRUN npm install\n\n# build necessary, even if no static files are needed,\n# since it builds the server as well\nRUN npm run build\n\n# expose 3000 on container\nEXPOSE 3000\n\n# set app serving to permissive \u002F assigned\nENV NUXT_HOST=0.0.0.0\n# set app port\nENV NUXT_PORT=3000\n\n# start the app\nCMD [ \"npm\", \"start\" ]\n```\n\n注意：\n1. 部署 Nuxt.js 服务端渲染的应用不能直接使用 nuxt 命令，而应该先进行编译构建，然后再启动 Nuxt 服务。\n2. 在build之前，需要ignore以下三个规则文件（手动创建.dockerignore文件）：\n\n```\nnode_modules\nnpm-debug*\n.nuxt\n```\n\n否则会出现镜像build失败的情况。\n\n运行命令：docker run -it -d -p 3000:3000 gzhiyi\u002Fnuxt-homepage  后面为镜像build后的名称，注意按实际情况进行更改。\n\n## nginx配置\n\nDocker运行node服务，如果需要外部访问的话，需要nginx反向代理。具体配置：\n\n```nginx\nserver {\n    listen 80;\n    server_name *your servername*;\n    location \u002F {\n        proxy_pass http:\u002F\u002Flocalhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n```\n## 访问\n需要配置host才能访问，如下：\n\n```hosts\n*your serverip* *your servername*\n```",bodyBegin:9,frontmatter:"title: Docker部署nuxtjs应用\ndescription: 有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。\nkeywords: docker,nuxtjs,ssr\nlabels: ['前端']\ndate: 2019-12-25"}}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.34d3e2bd.js"}catch(e){main="/client/legacy/client.9a4bf57e.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <script src="https://www.googletagmanager.com/gtag/js?id=UA-170295070-1" async></script> <script> window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-170295070-1'); </script> 