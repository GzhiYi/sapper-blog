<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=Mrn4dXO3Z_939geeswIgr2wIpspT6n7X5cX1Tjp69Ko name=google-site-verification> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=atom-one-light.min.css rel=stylesheet> <link href=client/client-8d9aba14.css rel=stylesheet><link href=client/[slug]-72c0ef40.css rel=stylesheet> <title>Docker部署nuxtjs应用-GzhiYi's blog</title><meta content=有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。 name=description data-svelte=svelte-2vncnt><meta content=docker,nuxtjs,ssr name=keywords data-svelte=svelte-2vncnt> <link href=/client/client.ab57a19f.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-8d9aba14.css rel=preload as=style><link href=/client/[slug].9997cae7.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/config.026ad977.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/[slug]-72c0ef40.css rel=preload as=style></head> <body> <div id=sapper> <nav class=svelte-1dbd5up><ul class=svelte-1dbd5up> <li class=svelte-1dbd5up><a aria-current=page class=svelte-1dbd5up href=blog rel=prefetch>blog</a></ul></nav> <main class=svelte-1y51i2> <div class="svelte-23vme9 base"><div class=label>前端</div> <div class="svelte-23vme9 title">Docker部署nuxtjs应用</div> <span class="svelte-23vme9 author">GzhiYi · 2019-12-25</span></div> <div class="svelte-23vme9 content"><p>有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。</p> <h2 id=dockerfile>Dockerfile</h2> <p>通过dockerfile可以build一个docker镜像。dockerfile内容如下：</p> <pre><code class=language-dockerfile><span class=hljs-keyword>FROM</span> node:11.13.0-alpine

<span class=hljs-comment># create destination directory</span>
<span class=hljs-builtin-name>RUN</span> mkdir -p /app
WORKDIR /app

<span class=hljs-comment># copy the app, note .dockerignore</span>
COPY . /app
<span class=hljs-builtin-name>RUN</span> npm install

<span class=hljs-comment># build necessary, even if no static files are needed,</span>
<span class=hljs-comment># since it builds the server as well</span>
<span class=hljs-builtin-name>RUN</span> npm <span class=hljs-builtin-name>run</span> build

<span class=hljs-comment># expose 3000 on container</span>
EXPOSE 3000

<span class=hljs-comment># set app serving to permissive / assigned</span>
ENV <span class=hljs-attribute>NUXT_HOST</span>=0.0.0.0
<span class=hljs-comment># set app port</span>
ENV <span class=hljs-attribute>NUXT_PORT</span>=3000

<span class=hljs-comment># start the app</span>
CMD [ <span class=hljs-string>"npm"</span>, <span class=hljs-string>"start"</span> ]
</code></pre> <p>注意：</p> <ol> <li>部署 Nuxt.js 服务端渲染的应用不能直接使用 nuxt 命令，而应该先进行编译构建，然后再启动 Nuxt 服务。</li> <li>在build之前，需要ignore以下三个规则文件（手动创建.dockerignore文件）：</li> </ol> <pre><code><span class=hljs-attribute>node_modules</span>
npm-<span class=hljs-literal>debug</span>*
.nuxt
</code></pre> <p>否则会出现镜像build失败的情况。</p> <p>运行命令：docker run -it -d -p 3000:3000 gzhiyi/nuxt-homepage 后面为镜像build后的名称，注意按实际情况进行更改。</p> <h2 id=nginx配置>nginx配置</h2> <p>Docker运行node服务，如果需要外部访问的话，需要nginx反向代理。具体配置：</p> <pre><code class=language-nginx><span class=hljs-section>server</span> {
    <span class=hljs-attribute>listen</span> <span class=hljs-number>80</span>;
    <span class=hljs-attribute>server_name</span> *your servername*;
    <span class=hljs-attribute>location</span> / {
        <span class=hljs-attribute>proxy_pass</span> http://localhost:3000;
        <span class=hljs-attribute>proxy_http_version</span> <span class=hljs-number>1</span>.<span class=hljs-number>1</span>;
        <span class=hljs-attribute>proxy_set_header</span> Upgrade $http_upgrade;
        <span class=hljs-attribute>proxy_set_header</span> Connection <span class=hljs-string>'upgrade'</span>;
        <span class=hljs-attribute>proxy_set_header</span> Host $host;
        <span class=hljs-attribute>proxy_cache_bypass</span> $http_upgrade;
    }
}
</code></pre> <h2 id=访问>访问</h2> <p>需要配置host才能访问，如下：</p> <pre><code class=language-hosts><span class=hljs-comment>*your serverip* *your servername*</span>
</code></pre> </div> </main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"Docker部署nuxtjs应用",description:"有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。",keywords:"docker,nuxtjs,ssr",labels:["前端"],date:"2019-12-25",path:"2019\u002F12\u002Fdocker-nuxtjs.md",slug:"2019_12_docker-nuxtjs",html:"\u003Cp\u003E有个主页的项目需要用到ssr。所以选择nuxtjs进行主页开发。关于nextjs的使用可以到官方文档进行查看。这里主要是记录一下docker部署nuxtjs应用的一些小事情。\u003C\u002Fp\u003E\n\u003Ch2 id=\"dockerfile\"\u003EDockerfile\u003C\u002Fh2\u003E\n\u003Cp\u003E通过dockerfile可以build一个docker镜像。dockerfile内容如下：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"hljs-keyword\"\u003EFROM\u003C\u002Fspan\u003E node:11.13.0-alpine\n\n\u003Cspan class=\"hljs-comment\"\u003E# create destination directory\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-builtin-name\"\u003ERUN\u003C\u002Fspan\u003E mkdir -p \u002Fapp\nWORKDIR \u002Fapp\n\n\u003Cspan class=\"hljs-comment\"\u003E# copy the app, note .dockerignore\u003C\u002Fspan\u003E\nCOPY . \u002Fapp\n\u003Cspan class=\"hljs-builtin-name\"\u003ERUN\u003C\u002Fspan\u003E npm install\n\n\u003Cspan class=\"hljs-comment\"\u003E# build necessary, even if no static files are needed,\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E# since it builds the server as well\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-builtin-name\"\u003ERUN\u003C\u002Fspan\u003E npm \u003Cspan class=\"hljs-builtin-name\"\u003Erun\u003C\u002Fspan\u003E build\n\n\u003Cspan class=\"hljs-comment\"\u003E# expose 3000 on container\u003C\u002Fspan\u003E\nEXPOSE 3000\n\n\u003Cspan class=\"hljs-comment\"\u003E# set app serving to permissive \u002F assigned\u003C\u002Fspan\u003E\nENV \u003Cspan class=\"hljs-attribute\"\u003ENUXT_HOST\u003C\u002Fspan\u003E=0.0.0.0\n\u003Cspan class=\"hljs-comment\"\u003E# set app port\u003C\u002Fspan\u003E\nENV \u003Cspan class=\"hljs-attribute\"\u003ENUXT_PORT\u003C\u002Fspan\u003E=3000\n\n\u003Cspan class=\"hljs-comment\"\u003E# start the app\u003C\u002Fspan\u003E\nCMD [ \u003Cspan class=\"hljs-string\"\u003E&quot;npm&quot;\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-string\"\u003E&quot;start&quot;\u003C\u002Fspan\u003E ]\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E注意：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E部署 Nuxt.js 服务端渲染的应用不能直接使用 nuxt 命令，而应该先进行编译构建，然后再启动 Nuxt 服务。\u003C\u002Fli\u003E\n\u003Cli\u003E在build之前，需要ignore以下三个规则文件（手动创建.dockerignore文件）：\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cpre\u003E\u003Ccode\u003E\u003Cspan class=\"hljs-attribute\"\u003Enode_modules\u003C\u002Fspan\u003E\nnpm-\u003Cspan class=\"hljs-literal\"\u003Edebug\u003C\u002Fspan\u003E*\n.nuxt\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E否则会出现镜像build失败的情况。\u003C\u002Fp\u003E\n\u003Cp\u003E运行命令：docker run -it -d -p 3000:3000 gzhiyi\u002Fnuxt-homepage  后面为镜像build后的名称，注意按实际情况进行更改。\u003C\u002Fp\u003E\n\u003Ch2 id=\"nginx配置\"\u003Enginx配置\u003C\u002Fh2\u003E\n\u003Cp\u003EDocker运行node服务，如果需要外部访问的话，需要nginx反向代理。具体配置：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-nginx\"\u003E\u003Cspan class=\"hljs-section\"\u003Eserver\u003C\u002Fspan\u003E {\n    \u003Cspan class=\"hljs-attribute\"\u003Elisten\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E80\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-attribute\"\u003Eserver_name\u003C\u002Fspan\u003E *your servername*;\n    \u003Cspan class=\"hljs-attribute\"\u003Elocation\u003C\u002Fspan\u003E \u002F {\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_pass\u003C\u002Fspan\u003E http:\u002F\u002Flocalhost:3000;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_http_version\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_set_header\u003C\u002Fspan\u003E Upgrade $http_upgrade;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_set_header\u003C\u002Fspan\u003E Connection \u003Cspan class=\"hljs-string\"\u003E&#x27;upgrade&#x27;\u003C\u002Fspan\u003E;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_set_header\u003C\u002Fspan\u003E Host $host;\n        \u003Cspan class=\"hljs-attribute\"\u003Eproxy_cache_bypass\u003C\u002Fspan\u003E $http_upgrade;\n    }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"访问\"\u003E访问\u003C\u002Fh2\u003E\n\u003Cp\u003E需要配置host才能访问，如下：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-hosts\"\u003E\u003Cspan class=\"hljs-comment\"\u003E*your serverip* *your servername*\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.ab57a19f.js"}catch(e){main="/client/legacy/client.2d9a922f.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170295070-1"></script> <script> window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-170295070-1'); </script> 