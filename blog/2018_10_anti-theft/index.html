<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=Mrn4dXO3Z_939geeswIgr2wIpspT6n7X5cX1Tjp69Ko name=google-site-verification> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=atom-one-light.min.css rel=stylesheet> <link href=client/client-e118e612.css rel=stylesheet> <title>防盗链的解析-GzhiYi's blog</title><meta content=最近涉及到了图片防盗链的问题，链接是特殊的，不能被其他网站解析为图片。说下来有几种办法，当然解决后发现还是最后那种简单便捷。唯一的缺点就是大概也许差不多可能无法访问到。这个没关系，只要保佑保佑，总会比加iframe轻松愉悦的。 name=description data-svelte=svelte-2vncnt><meta content=防盗链 name=keywords data-svelte=svelte-2vncnt> <link href=/client/client.1c84caa9.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-e118e612.css rel=preload as=style><link href=/client/[slug].9af4de7d.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/config.026ad977.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials></head> <body> <div id=sapper> <nav class=svelte-1dbd5up><ul class=svelte-1dbd5up><li class=svelte-1dbd5up><a class=svelte-1dbd5up href=.>home</a></li> <li class=svelte-1dbd5up><a class=svelte-1dbd5up href=about>about</a></li> <li class=svelte-1dbd5up><a class=svelte-1dbd5up href=blog aria-current=page rel=prefetch>blog</a></ul></nav> <main class=svelte-1uhnsl8> <div class=flex><div class=base><div class=title>防盗链的解析</div> <span>2018-10-15</span></div> <div class=content><h3 id=前言>前言</h3> <p>最近涉及到了图片防盗链的问题，链接是特殊的，不能被其他网站解析为图片。说下来有几种办法，当然解决后发现还是最后那种简单便捷。唯一的缺点就是大概也许差不多可能无法访问到。这个没关系，只要保佑保佑，总会比加iframe轻松愉悦的。 </p> <p>首先，你看到的图片会是这样的：</p> <p><img align=center alt=例图 data-zoomable src="https://mmbiz.qpic.cn/mmbiz_jpg/cfehZicXpD0ib9BP0iafksSmxPcWm4ORDGkD5ibHIHeWSyWjHriaFGhHLFvZNwiau4icCOBvT56MktVFATAf1D8vuyOHw/0?wx_fmt=jpeg" style=width:100%> </p> <p>实际上，如果你能看到上面这张图，说明你骨骼精奇，自带解锁功能。 但是我们想直接看到： </p> <p><img align=center alt=例图 data-zoomable src="https://images.weserv.nl/?url=//mmbiz.qpic.cn/mmbiz_jpg/cfehZicXpD0ib9BP0iafksSmxPcWm4ORDGkD5ibHIHeWSyWjHriaFGhHLFvZNwiau4icCOBvT56MktVFATAf1D8vuyOHw/0?wx_fmt=jpeg" style=width:100%> </p> <p>那怎么做呢？</p> <h3 id=页面头部加入标签>页面头部加入<mate>标签</mate></h3> <pre><code class=language-html>&lt;meta <span class=hljs-attribute>name</span>=<span class=hljs-string>"referrer"</span> <span class=hljs-attribute>content</span>=<span class=hljs-string>"never"</span>>
</code></pre> <p>这种办法通过控制referer绕过防盗链的检测。html可以通过这个参数决定http请求中的referer，要注意使用这个标签属性的时候，浏览器原有的referer策略就发生改变了。</p> <h3 id=图片在iframe内显示>图片在iframe内显示</h3> <pre><code class=language-javascript><span class=hljs-keyword>let</span> <span class=hljs-built_in>url</span>=<span class=hljs-string>'防盗的链接'</span>;
<span class=hljs-keyword>let</span> finalUrl = displayImg(<span class=hljs-built_in>url</span>);
<span class=hljs-built_in>console</span>.log(finalUrl);
<span class=hljs-built_in>document</span>.getElementById(<span class=hljs-string>'img'</span>).innerHTML = finalUrl;

displayImg = (<span class=hljs-built_in>url</span>) => {
    <span class=hljs-keyword>let</span> iFrameid = <span class=hljs-string>'frameimg'</span> + <span class=hljs-built_in>Math</span>.random();
    <span class=hljs-built_in>window</span>.img = <span class=hljs-string>'&lt;img id="img" src=\''</span> + <span class=hljs-built_in>url</span> + <span class=hljs-string>'?'</span> + <span class=hljs-built_in>Math</span>.random() + <span class=hljs-string>'\' />'</span>;
    <span class=hljs-keyword>return</span> <span class=hljs-string>'&lt;iframe id="'</span> + iFrameid + <span class=hljs-string>'" src="javascript:parent.img;" frameBorder="0" scrolling="no" width="100%">&lt;/iframe>'</span>;
}
</code></pre> <p>这样可以正常显示图片，除了多了iframe外也没啥太大的问题，但是我发现在Vue里面一旦数据更新iframe就会刷新，外加上插件vue-draggable没法用了所以我就放弃这个方法了。这也促使我找更好的方案👇。</p> <h3 id=传送门--跳板>传送门 | 跳板</h3> <p>所以最后我还是找到了一个好的方法，搜索引擎下，发现大部分的跳板都被清理了。不要慌，总会有的，对于怎么找到这个跳板的话，我的建议是怎么不去对比一下开头的两张图？😄😄😄</p> </div> </div></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"防盗链的解析",description:"最近涉及到了图片防盗链的问题，链接是特殊的，不能被其他网站解析为图片。说下来有几种办法，当然解决后发现还是最后那种简单便捷。唯一的缺点就是大概也许差不多可能无法访问到。这个没关系，只要保佑保佑，总会比加iframe轻松愉悦的。",keywords:"防盗链",labels:["前端"],date:"2018-10-15",path:"2018\u002F10\u002Fanti-theft.md",slug:"2018_10_anti-theft",html:"\u003Ch3 id=\"前言\"\u003E前言\u003C\u002Fh3\u003E\n\u003Cp\u003E最近涉及到了图片防盗链的问题，链接是特殊的，不能被其他网站解析为图片。说下来有几种办法，当然解决后发现还是最后那种简单便捷。唯一的缺点就是大概也许差不多可能无法访问到。这个没关系，只要保佑保佑，总会比加iframe轻松愉悦的。  \u003C\u002Fp\u003E\n\u003Cp\u003E首先，你看到的图片会是这样的：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg align=\"center\" style=\"width: 100%;\" data-zoomable src=\"https:\u002F\u002Fmmbiz.qpic.cn\u002Fmmbiz_jpg\u002FcfehZicXpD0ib9BP0iafksSmxPcWm4ORDGkD5ibHIHeWSyWjHriaFGhHLFvZNwiau4icCOBvT56MktVFATAf1D8vuyOHw\u002F0?wx_fmt=jpeg\" alt=\"例图\" \u003E  \u003C\u002Fp\u003E\n\u003Cp\u003E实际上，如果你能看到上面这张图，说明你骨骼精奇，自带解锁功能。\n但是我们想直接看到：  \u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg align=\"center\" style=\"width: 100%;\" data-zoomable src=\"https:\u002F\u002Fimages.weserv.nl\u002F?url=\u002F\u002Fmmbiz.qpic.cn\u002Fmmbiz_jpg\u002FcfehZicXpD0ib9BP0iafksSmxPcWm4ORDGkD5ibHIHeWSyWjHriaFGhHLFvZNwiau4icCOBvT56MktVFATAf1D8vuyOHw\u002F0?wx_fmt=jpeg\" alt=\"例图\" \u003E  \u003C\u002Fp\u003E\n\u003Cp\u003E那怎么做呢？\u003C\u002Fp\u003E\n\u003Ch3 id=\"页面头部加入标签\"\u003E页面头部加入\u003Cmate\u003E标签\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-html\"\u003E&lt;meta \u003Cspan class=\"hljs-attribute\"\u003Ename\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E&quot;referrer&quot;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attribute\"\u003Econtent\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E&quot;never&quot;\u003C\u002Fspan\u003E&gt;\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E这种办法通过控制referer绕过防盗链的检测。html可以通过这个参数决定http请求中的referer，要注意使用这个标签属性的时候，浏览器原有的referer策略就发生改变了。\u003C\u002Fp\u003E\n\u003Ch3 id=\"图片在iframe内显示\"\u003E图片在iframe内显示\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003Eurl\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E&#x27;防盗的链接&#x27;\u003C\u002Fspan\u003E;\n\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E finalUrl = displayImg(\u003Cspan class=\"hljs-built_in\"\u003Eurl\u003C\u002Fspan\u003E);\n\u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(finalUrl);\n\u003Cspan class=\"hljs-built_in\"\u003Edocument\u003C\u002Fspan\u003E.getElementById(\u003Cspan class=\"hljs-string\"\u003E&#x27;img&#x27;\u003C\u002Fspan\u003E).innerHTML = finalUrl;\n\ndisplayImg = (\u003Cspan class=\"hljs-built_in\"\u003Eurl\u003C\u002Fspan\u003E) =&gt; {\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E iFrameid = \u003Cspan class=\"hljs-string\"\u003E&#x27;frameimg&#x27;\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-built_in\"\u003EMath\u003C\u002Fspan\u003E.random();\n    \u003Cspan class=\"hljs-built_in\"\u003Ewindow\u003C\u002Fspan\u003E.img = \u003Cspan class=\"hljs-string\"\u003E&#x27;&lt;img id=&quot;img&quot; src=\\&#x27;&#x27;\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-built_in\"\u003Eurl\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-string\"\u003E&#x27;?&#x27;\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-built_in\"\u003EMath\u003C\u002Fspan\u003E.random() + \u003Cspan class=\"hljs-string\"\u003E&#x27;\\&#x27; \u002F&gt;&#x27;\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&#x27;&lt;iframe id=&quot;&#x27;\u003C\u002Fspan\u003E + iFrameid + \u003Cspan class=\"hljs-string\"\u003E&#x27;&quot; src=&quot;javascript:parent.img;&quot; frameBorder=&quot;0&quot; scrolling=&quot;no&quot; width=&quot;100%&quot;&gt;&lt;\u002Fiframe&gt;&#x27;\u003C\u002Fspan\u003E;\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E这样可以正常显示图片，除了多了iframe外也没啥太大的问题，但是我发现在Vue里面一旦数据更新iframe就会刷新，外加上插件vue-draggable没法用了所以我就放弃这个方法了。这也促使我找更好的方案👇。\u003C\u002Fp\u003E\n\u003Ch3 id=\"传送门--跳板\"\u003E传送门 | 跳板\u003C\u002Fh3\u003E\n\u003Cp\u003E所以最后我还是找到了一个好的方法，搜索引擎下，发现大部分的跳板都被清理了。不要慌，总会有的，对于怎么找到这个跳板的话，我的建议是怎么不去对比一下开头的两张图？😄😄😄\u003C\u002Fp\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.1c84caa9.js"}catch(e){main="/client/legacy/client.80874f6f.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170295070-1"></script> <script> window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-170295070-1'); </script> 