{"title":"vue获取不到dom节点","description":"开发中出现拿不到dom节点的问题，在mounted后也读取不到节点","keywords":"vue，dom节点，node，获取不到，loading，echarts，渲染，图表","labels":["前端"],"date":"2021-06-29","path":"2021/06/vue-dom-not-found.md","slug":"2021_06_vue-dom-not-found","html":"<p>在vue开发中，出现拿不到dom节点的问题，具体的场景是页面需要对echarts进行实例化，画布需要挂在到某个id的dom上，图表的数据需要从接口上获取，大致的代码如下：</p>\n<pre><code class=\"language-vue\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;pug&quot;</span>&gt;</span>\n  div#render-id\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n  <span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> {\n    <span class=\"hljs-function\"><span class=\"hljs-title\">mounted</span>(<span class=\"hljs-params\"></span>)</span> {\n      <span class=\"hljs-built_in\">this</span>.getChartData()\n    },\n    <span class=\"hljs-attr\">methods</span>: {\n      <span class=\"hljs-keyword\">async</span> <span class=\"hljs-function\"><span class=\"hljs-title\">getChartData</span>(<span class=\"hljs-params\"></span>)</span> {\n        <span class=\"hljs-comment\">// do fetch chart data</span>\n        <span class=\"hljs-built_in\">this</span>.renderChart()\n      },\n      <span class=\"hljs-function\"><span class=\"hljs-title\">renderChart</span>(<span class=\"hljs-params\"></span>)</span> {\n        <span class=\"hljs-keyword\">const</span> node = <span class=\"hljs-built_in\">document</span>.querySelector(<span class=\"hljs-string\">&#x27;#render-id&#x27;</span>)\n        <span class=\"hljs-built_in\">console</span>.log(node) \n      }\n    }\n  }\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n</code></pre>\n<p>出现的异常：</p>\n<pre><code> Cannot <span class=\"hljs-keyword\">read</span> <span class=\"hljs-keyword\">property</span><span class=\"hljs-title\"> </span>&#x27;getAttribute&#x27; of undefined<span class=\"hljs-string\">&quot;</span>\n</code></pre>\n<p>打印node节点发现为null。</p>\n<h3 id=\"问题解决\">问题解决</h3>\n<p>解决这个问题需要知道的是，获取不到节点的直接原因就是在query节点的时候render-id还没挂载到dom上。但会问，不是在mounted后才读这个节点吗？按照上面的代码逻辑，想法是正确的，即便是接口数据大，获取数据的时间长，也会在render-id这个元素挂载到dom后才会执行query操作。理论是不会出现读取不到该节点的问题。</p>\n<p>处理思路应该聚集在渲染dom有什么另外的操作会影响。总结无外乎就是：</p>\n<ol>\n<li>优先确认query节点的操作要在dom渲染完成后操作（这是核心思路）。</li>\n<li>检查有无异步的操作产生影响。比如元素需要在接口获取到之后写入到document，但写入前读取是会出现这样的问题的。</li>\n<li>检查获取的元素或者元素的外层是否有loading的操作。</li>\n<li>$nextTick(f)有时候会解决此类问题。</li>\n</ol>\n"}