<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=Mrn4dXO3Z_939geeswIgr2wIpspT6n7X5cX1Tjp69Ko name=google-site-verification> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=atom-one-light.min.css rel=stylesheet> <link href=client/client-8d9aba14.css rel=stylesheet><link href=client/[slug]-72c0ef40.css rel=stylesheet> <title>使用github actions自动编译部署sapper-blog-GzhiYi's blog</title><meta content="使用github actions打包部署sapper项目并部署到github pages。" name=description data-svelte=svelte-2vncnt><meta content="github actions,sapper,github pages" name=keywords data-svelte=svelte-2vncnt> <link href=/client/client.ab57a19f.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-8d9aba14.css rel=preload as=style><link href=/client/[slug].9997cae7.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/config.026ad977.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/[slug]-72c0ef40.css rel=preload as=style></head> <body> <div id=sapper> <nav class=svelte-1dbd5up><ul class=svelte-1dbd5up> <li class=svelte-1dbd5up><a href=blog aria-current=page class=svelte-1dbd5up rel=prefetch>blog</a></ul></nav> <main class=svelte-1y51i2> <div class="svelte-23vme9 base"><div class=label>前端</div> <div class="svelte-23vme9 title">使用github actions自动编译部署sapper-blog</div> <span class="svelte-23vme9 author">GzhiYi · 2020-06-22</span></div> <div class="svelte-23vme9 content"><p>之前构建好了的<a href=/blog/2020-06_build-blog target=_blank>博客</a>，通过编写一个脚本实现本地自动化部署。脚本实现的功能就是在本地处理项目的打包并将静态文件推送到远端的<code>gh-pages</code>分支以实现静态文件部署。在了解github actions之后，决定增加一个自动化打包部署的workflow。这样就可以将编译打包的操作完全放置在”云端“。</p> <h2 id=编写workflow配置文件>编写workflow配置文件</h2> <p>在项目根目录创建<code>.github/workflows/main.yml</code></p> <pre><code class=language-yaml><span class=hljs-attr>name:</span> <span class=hljs-string>Deploy</span> <span class=hljs-string>GitHub</span> <span class=hljs-string>Pages</span>

<span class=hljs-attr>on:</span>
  <span class=hljs-attr>push:</span>
      <span class=hljs-comment># push钩子监听的分支，为编译打包的分支</span>
    <span class=hljs-attr>branches:</span>
      <span class=hljs-bullet>-</span> <span class=hljs-string>feat/dev</span>

<span class=hljs-comment># 任务</span>
<span class=hljs-attr>jobs:</span>
  <span class=hljs-attr>build-and-deploy:</span>
    <span class=hljs-comment># 服务器环境：最新版 Ubuntu</span>
    <span class=hljs-attr>runs-on:</span> <span class=hljs-string>ubuntu-latest</span>
    <span class=hljs-attr>steps:</span>
      <span class=hljs-comment># 拉取代码</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>name:</span> <span class=hljs-string>Checkout</span>
        <span class=hljs-attr>uses:</span> <span class=hljs-string>actions/checkout@v2</span>
        <span class=hljs-attr>with:</span>
          <span class=hljs-attr>persist-credentials:</span> <span class=hljs-literal>false</span>

      <span class=hljs-comment># 生成静态文件</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>name:</span> <span class=hljs-string>Build</span>
        <span class=hljs-attr>run:</span> <span class=hljs-string>npm</span> <span class=hljs-string>install</span> <span class=hljs-string>&&</span> <span class=hljs-string>npm</span> <span class=hljs-string>run</span> <span class=hljs-string>export</span> <span class=hljs-string>&&</span> <span class=hljs-string>cp</span> <span class=hljs-string>-i</span> <span class=hljs-string>CNAME</span> <span class=hljs-string>__sapper__/export</span>

      <span class=hljs-comment># 部署到 GitHub Pages</span>
      <span class=hljs-bullet>-</span> <span class=hljs-attr>name:</span> <span class=hljs-string>Deploy</span>
        <span class=hljs-attr>uses:</span> <span class=hljs-string>JamesIves/github-pages-deploy-action@releases/v3</span>
        <span class=hljs-attr>with:</span>
          <span class=hljs-attr>ACCESS_TOKEN:</span> <span class=hljs-string>${{</span> <span class=hljs-string>secrets.GH_PAGES</span> <span class=hljs-string>}}</span>
          <span class=hljs-attr>BRANCH:</span> <span class=hljs-string>gh-pages</span>
          <span class=hljs-attr>FOLDER:</span> <span class=hljs-string>__sapper__/export</span>
</code></pre> <p>上面配置有个别要注意的点：</p> <ol> <li><p>branches需要设置为要处理的分支。</p> </li> <li><p>with/ACCESS_TOKEN为github生成的token。</p> <p>生成步骤：</p> <p><a href=https://github.com/settings/tokens target=_blank>github右上角的Settings-Developer settings-Personal access tokens</a> 点击<code>Generate new token</code>，为了和配置文件对应，token的note需要填写为GH_PAGES，然后勾选scope为repo。</p> <p>在博客的仓库的setting设置secret。</p> <p><img align=center alt=Xnip2020-06-22_14-12-10.jpg data-zoomable src=https://i.loli.net/2020/06/22/jurxoLcUY7p5C8a.jpg style=width:100%;margin-bottom:20px;border-radius:8px;background:#f8fdf3></p> </li> <li><p>with/FOLDER为sapper导出export的静态文件目录。</p> </li> </ol> <p>以上完成之后，将代码push到远端仓库，就可以在Actions看到名字为<code>Deploy Github Pages</code>的workflow。</p> <p><img align=center alt=Xnip2020-06-22_14-15-32.jpg data-zoomable src=https://i.loli.net/2020/06/22/bCxitLWKVlgHD8P.jpg style=width:100%;margin-bottom:20px;border-radius:8px;background:#f8fdf3></p> <h2 id=体会>体会</h2> <p>Github Actions比在公司使用gitlab cicd快了不少，体验非常不错。在写完博客之后，只需要做的，只有将更新的内容push到github就可以了。</p> </div> </main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"使用github actions自动编译部署sapper-blog",description:"使用github actions打包部署sapper项目并部署到github pages。",keywords:"github actions,sapper,github pages",labels:["前端"],date:"2020-06-22",path:"2020\u002F06\u002Fsapper-github-actions.md",slug:"2020_06_sapper-github-actions",html:"\u003Cp\u003E之前构建好了的\u003Ca target='_blank'  href=\"\u002Fblog\u002F2020-06_build-blog\"\u003E博客\u003C\u002Fa\u003E，通过编写一个脚本实现本地自动化部署。脚本实现的功能就是在本地处理项目的打包并将静态文件推送到远端的\u003Ccode\u003Egh-pages\u003C\u002Fcode\u003E分支以实现静态文件部署。在了解github actions之后，决定增加一个自动化打包部署的workflow。这样就可以将编译打包的操作完全放置在”云端“。\u003C\u002Fp\u003E\n\u003Ch2 id=\"编写workflow配置文件\"\u003E编写workflow配置文件\u003C\u002Fh2\u003E\n\u003Cp\u003E在项目根目录创建\u003Ccode\u003E.github\u002Fworkflows\u002Fmain.yml\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-yaml\"\u003E\u003Cspan class=\"hljs-attr\"\u003Ename:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003EDeploy\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003EGitHub\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003EPages\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-attr\"\u003Eon:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Epush:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-comment\"\u003E# push钩子监听的分支，为编译打包的分支\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Ebranches:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Efeat\u002Fdev\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-comment\"\u003E# 任务\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-attr\"\u003Ejobs:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Ebuild-and-deploy:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-comment\"\u003E# 服务器环境：最新版 Ubuntu\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Eruns-on:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Eubuntu-latest\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003Esteps:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-comment\"\u003E# 拉取代码\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ename:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003ECheckout\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Euses:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Eactions\u002Fcheckout@v2\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Ewith:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003Epersist-credentials:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-literal\"\u003Efalse\u003C\u002Fspan\u003E\n\n      \u003Cspan class=\"hljs-comment\"\u003E# 生成静态文件\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ename:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003EBuild\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Erun:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Enpm\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Einstall\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Enpm\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Erun\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Ecp\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E-i\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003ECNAME\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E__sapper__\u002Fexport\u003C\u002Fspan\u003E\n\n      \u003Cspan class=\"hljs-comment\"\u003E# 部署到 GitHub Pages\u003C\u002Fspan\u003E\n      \u003Cspan class=\"hljs-bullet\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ename:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003EDeploy\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Euses:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003EJamesIves\u002Fgithub-pages-deploy-action@releases\u002Fv3\u003C\u002Fspan\u003E\n        \u003Cspan class=\"hljs-attr\"\u003Ewith:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003EACCESS_TOKEN:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E${{\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Esecrets.GH_PAGES\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E}}\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003EBRANCH:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003Egh-pages\u003C\u002Fspan\u003E\n          \u003Cspan class=\"hljs-attr\"\u003EFOLDER:\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E__sapper__\u002Fexport\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E上面配置有个别要注意的点：\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cp\u003Ebranches需要设置为要处理的分支。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003Ewith\u002FACCESS_TOKEN为github生成的token。\u003C\u002Fp\u003E\n\u003Cp\u003E生成步骤：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca target='_blank'  href=\"https:\u002F\u002Fgithub.com\u002Fsettings\u002Ftokens\"\u003Egithub右上角的Settings-Developer settings-Personal access tokens\u003C\u002Fa\u003E 点击\u003Ccode\u003EGenerate new token\u003C\u002Fcode\u003E，为了和配置文件对应，token的note需要填写为GH_PAGES，然后勾选scope为repo。\u003C\u002Fp\u003E\n\u003Cp\u003E在博客的仓库的setting设置secret。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg align=\"center\" style=\"width: 100%;margin-bottom: 20px;border-radius: 8px;background: #f8fdf3;\" data-zoomable src=\"https:\u002F\u002Fi.loli.net\u002F2020\u002F06\u002F22\u002FjurxoLcUY7p5C8a.jpg\" alt=\"Xnip2020-06-22_14-12-10.jpg\" \u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003Ewith\u002FFOLDER为sapper导出export的静态文件目录。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E以上完成之后，将代码push到远端仓库，就可以在Actions看到名字为\u003Ccode\u003EDeploy Github Pages\u003C\u002Fcode\u003E的workflow。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg align=\"center\" style=\"width: 100%;margin-bottom: 20px;border-radius: 8px;background: #f8fdf3;\" data-zoomable src=\"https:\u002F\u002Fi.loli.net\u002F2020\u002F06\u002F22\u002FbCxitLWKVlgHD8P.jpg\" alt=\"Xnip2020-06-22_14-15-32.jpg\" \u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"体会\"\u003E体会\u003C\u002Fh2\u003E\n\u003Cp\u003EGithub Actions比在公司使用gitlab cicd快了不少，体验非常不错。在写完博客之后，只需要做的，只有将更新的内容push到github就可以了。\u003C\u002Fp\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.ab57a19f.js"}catch(e){main="/client/legacy/client.2d9a922f.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170295070-1"></script> <script> window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-170295070-1'); </script> 