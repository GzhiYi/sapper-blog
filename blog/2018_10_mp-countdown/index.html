<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=Mrn4dXO3Z_939geeswIgr2wIpspT6n7X5cX1Tjp69Ko name=google-site-verification> <base href=/ > <link href=global.css rel=stylesheet> <link href=main.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=atom-one-light.min.css rel=stylesheet> <script async src=//unpkg.com/valine/dist/Valine.min.js></script> <script async src=https://unpkg.com/ajax-hook@2.0.3/dist/ajaxhook.min.js></script> <link href=client/main.3202803961.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>用小程序做个动态倒计时-GzhiYi's blog</title><meta content=最近由于业务需要，需要做一个倒计时的小插件，想想自己在很久以前用JavaScript写过，操作dom，很快就可以修改对应的数字了。现在换到小程序后，主要的还是去更改data的值，进而修改对应的图片。 name=description><meta content=小程序,倒计时,编写 name=keywords><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <nav class=svelte-1wr5yce><ul class=svelte-1wr5yce> <li class=svelte-1wr5yce><a aria-current=blog class=svelte-1wr5yce href=/ rel=prefetch>blog</a></ul></nav> <main class=svelte-iwmse4> <div class="svelte-1hcu46h content"><h1>用小程序做个动态倒计时</h1> <p class="svelte-1hcu46h desc">10/15/2018 <span class="svelte-1hcu46h label">小程序</span></p> <h3 id=写在前>写在前</h3> <p>最近由于业务需要，需要做一个倒计时的小插件，想想自己在很久以前用JavaScript写过，操作dom，很快就可以修改对应的数字了。现在换到小程序后，主要的还是去更改data的值，进而修改对应的图片。 </p> <h3 id=效果>效果</h3> <p><img align=center alt=counter data-zoomable src=https://images.vrm.cn/2018/11/22/微信截图_20181122151328.png style=width:100%> 具体： </p> <ul> <li>精度为天时分秒</li> <li>初始时间可以从接口获取</li> </ul> <h3 id=代码>代码</h3> <pre><code class=language-html>  <span class=hljs-tag>&lt;<span class=hljs-name>view</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"counter"</span>></span>
    距离活动结束仅剩
    <span class=hljs-tag>&lt;<span class=hljs-name>image</span> <span class=hljs-attr>bindload</span>=<span class=hljs-string>"showPicture"</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"clock"</span> <span class=hljs-attr>mode</span>=<span class=hljs-string>"widthFix"</span> <span class=hljs-attr>src</span>=<span class=hljs-string>"../../src/images/clock/num{{count.dayBegin}}.png"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>image</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>image</span> <span class=hljs-attr>bindload</span>=<span class=hljs-string>"showPicture"</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"clock"</span> <span class=hljs-attr>mode</span>=<span class=hljs-string>"widthFix"</span> <span class=hljs-attr>src</span>=<span class=hljs-string>"../../src/images/clock/num{{count.dayEnd}}.png"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>image</span>></span>
    天
    <span class=hljs-tag>&lt;<span class=hljs-name>image</span> <span class=hljs-attr>bindload</span>=<span class=hljs-string>"showPicture"</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"clock"</span> <span class=hljs-attr>mode</span>=<span class=hljs-string>"widthFix"</span> <span class=hljs-attr>src</span>=<span class=hljs-string>"../../src/images/clock/num{{count.hourBegin}}.png"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>image</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>image</span> <span class=hljs-attr>bindload</span>=<span class=hljs-string>"showPicture"</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"clock"</span> <span class=hljs-attr>mode</span>=<span class=hljs-string>"widthFix"</span> <span class=hljs-attr>src</span>=<span class=hljs-string>"../../src/images/clock/num{{count.hourEnd}}.png"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>image</span>></span>
    时
    <span class=hljs-tag>&lt;<span class=hljs-name>image</span> <span class=hljs-attr>bindload</span>=<span class=hljs-string>"showPicture"</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"clock"</span> <span class=hljs-attr>mode</span>=<span class=hljs-string>"widthFix"</span> <span class=hljs-attr>src</span>=<span class=hljs-string>"../../src/images/clock/num{{count.minuteBegin}}.png"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>image</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>image</span> <span class=hljs-attr>bindload</span>=<span class=hljs-string>"showPicture"</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"clock"</span> <span class=hljs-attr>mode</span>=<span class=hljs-string>"widthFix"</span> <span class=hljs-attr>src</span>=<span class=hljs-string>"../../src/images/clock/num{{count.minuteEnd}}.png"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>image</span>></span>
    分
    <span class=hljs-tag>&lt;<span class=hljs-name>image</span> <span class=hljs-attr>bindload</span>=<span class=hljs-string>"showPicture"</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"clock"</span> <span class=hljs-attr>mode</span>=<span class=hljs-string>"widthFix"</span> <span class=hljs-attr>src</span>=<span class=hljs-string>"../../src/images/clock/num{{count.secondBegin}}.png"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>image</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>image</span> <span class=hljs-attr>bindload</span>=<span class=hljs-string>"showPicture"</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"clock"</span> <span class=hljs-attr>mode</span>=<span class=hljs-string>"widthFix"</span> <span class=hljs-attr>src</span>=<span class=hljs-string>"../../src/images/clock/num{{count.secondEnd}}.png"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>image</span>></span>
    秒
  <span class=hljs-tag>&lt;/<span class=hljs-name>view</span>></span></code></pre> <pre><code class=language-javascript><span class=hljs-comment>// 初始值</span>
<span class=hljs-attr>timer</span>: <span class=hljs-literal>null</span>,
<span class=hljs-attr>data</span>: {
  <span class=hljs-attr>count</span>: {
    <span class=hljs-attr>expireDate</span>: <span class=hljs-number>172800</span>, <span class=hljs-comment>// s</span>
    <span class=hljs-attr>dayBegin</span>: <span class=hljs-number>0</span>,
    <span class=hljs-attr>dayEnd</span>: <span class=hljs-number>0</span>,
    <span class=hljs-attr>hourBegin</span>: <span class=hljs-number>0</span>,
    <span class=hljs-attr>hourEnd</span>: <span class=hljs-number>0</span>,
    <span class=hljs-attr>minuteBegin</span>: <span class=hljs-number>0</span>,
    <span class=hljs-attr>minuteEnd</span>: <span class=hljs-number>0</span>,
    <span class=hljs-attr>secondBegin</span>: <span class=hljs-number>0</span>,
    <span class=hljs-attr>secondEnd</span>: <span class=hljs-number>0</span>
  }
}

<span class=hljs-comment>// 接口回调处</span>
<span class=hljs-keyword>let</span> { count } = <span class=hljs-keyword>this</span>.data
delele count[<span class=hljs-string>`expireDate`</span>] <span class=hljs-comment>// 删除原count中的expireDate</span>
<span class=hljs-keyword>this</span>.setData({
  ...count,
  <span class=hljs-attr>expireDate</span>: newExpireDate
})
<span class=hljs-keyword>this</span>.timer = setInterval(<span class=hljs-function><span class=hljs-keyword>function</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>let</span> expireDate = <span class=hljs-keyword>this</span>.data.count.expireDate - <span class=hljs-number>1</span>
  <span class=hljs-keyword>this</span>.setData({
    <span class=hljs-attr>count</span>: {
      <span class=hljs-attr>dayBegin</span>: <span class=hljs-keyword>this</span>.convertTime(expireDate)[<span class=hljs-number>0</span>][<span class=hljs-number>0</span>],
      <span class=hljs-attr>dayEnd</span>: <span class=hljs-keyword>this</span>.convertTime(expireDate)[<span class=hljs-number>0</span>][<span class=hljs-number>1</span>],
      <span class=hljs-attr>hourBegin</span>: <span class=hljs-keyword>this</span>.convertTime(expireDate)[<span class=hljs-number>1</span>][<span class=hljs-number>0</span>],
      <span class=hljs-attr>hourEnd</span>: <span class=hljs-keyword>this</span>.convertTime(expireDate)[<span class=hljs-number>1</span>][<span class=hljs-number>1</span>],
      <span class=hljs-attr>minuteBegin</span>: <span class=hljs-keyword>this</span>.convertTime(expireDate)[<span class=hljs-number>2</span>][<span class=hljs-number>0</span>],
      <span class=hljs-attr>minuteEnd</span>: <span class=hljs-keyword>this</span>.convertTime(expireDate)[<span class=hljs-number>2</span>][<span class=hljs-number>1</span>],
      <span class=hljs-attr>secondBegin</span>: <span class=hljs-keyword>this</span>.convertTime(expireDate)[<span class=hljs-number>3</span>][<span class=hljs-number>0</span>],
      <span class=hljs-attr>secondEnd</span>: <span class=hljs-keyword>this</span>.convertTime(expireDate)[<span class=hljs-number>3</span>][<span class=hljs-number>1</span>],
      expireDate,
    }
  })
}, <span class=hljs-number>1000</span>)

<span class=hljs-comment>/**
 * 时间转化函数，时间戳入参为秒
*/</span>
<span class=hljs-attr>convertTime</span>: <span class=hljs-function><span class=hljs-keyword>function</span> (<span class=hljs-params>sec</span>) </span>{
  <span class=hljs-keyword>let</span> time
  <span class=hljs-keyword>if</span> (sec > <span class=hljs-number>-1</span>) {
    <span class=hljs-keyword>let</span> hour = <span class=hljs-built_in>Math</span>.floor(sec / <span class=hljs-number>3600</span>)
    <span class=hljs-keyword>let</span> min = <span class=hljs-built_in>Math</span>.floor(sec / <span class=hljs-number>60</span>) % <span class=hljs-number>60</span>
    <span class=hljs-keyword>let</span> second = sec % <span class=hljs-number>60</span>
    <span class=hljs-keyword>let</span> day = <span class=hljs-built_in>parseInt</span>(hour / <span class=hljs-number>24</span>)
    hour = hour - <span class=hljs-number>24</span> * day
    hour = hour &lt; <span class=hljs-number>10</span> ? <span class=hljs-string>`0<span class=hljs-subst>${hour}</span>`</span> : hour
    time = day &lt; <span class=hljs-number>10</span> ? <span class=hljs-string>`0<span class=hljs-subst>${day}</span>:<span class=hljs-subst>${hour}</span>:`</span>: <span class=hljs-string>`<span class=hljs-subst>${day}</span>:<span class=hljs-subst>${hour}</span>:`</span>
    <span class=hljs-keyword>if</span> (min &lt; <span class=hljs-number>10</span>) {
      time += <span class=hljs-string>"0"</span>
    }
    time += min + <span class=hljs-string>":"</span>;
    <span class=hljs-keyword>if</span> (second &lt; <span class=hljs-number>10</span>) {
      time += <span class=hljs-string>"0"</span>
    }
    time += second
    <span class=hljs-keyword>return</span> time.split(<span class=hljs-string>':'</span>) <span class=hljs-comment>// 返回一个包含天时分秒的数组</span>
  }
}
<span class=hljs-comment>// 最后不要忘记在周期销毁处清空计时器</span>
<span class=hljs-attr>onUnload</span>: <span class=hljs-function><span class=hljs-keyword>function</span> (<span class=hljs-params></span>) </span>{
  clearInterval(<span class=hljs-keyword>this</span>.timer)
}</code></pre> <pre><code class=language-javascript><span class=hljs-comment>// 时间转 **前的函数</span>
  <span class=hljs-attr>getDateDiff</span>: <span class=hljs-function><span class=hljs-keyword>function</span>(<span class=hljs-params>dateTimeStamp</span>)</span>{
    <span class=hljs-keyword>let</span> result = <span class=hljs-string>''</span>
    <span class=hljs-keyword>let</span> minute = <span class=hljs-number>1000</span> * <span class=hljs-number>60</span>
    <span class=hljs-keyword>let</span> hour = minute * <span class=hljs-number>60</span>
    <span class=hljs-keyword>let</span> day = hour * <span class=hljs-number>24</span>
    <span class=hljs-keyword>let</span> halfamonth = day * <span class=hljs-number>15</span>
    <span class=hljs-keyword>let</span> month = day * <span class=hljs-number>30</span>
    <span class=hljs-keyword>let</span> now = <span class=hljs-keyword>new</span> <span class=hljs-built_in>Date</span>().getTime()
    <span class=hljs-keyword>let</span> diffValue = now - dateTimeStamp
    <span class=hljs-keyword>if</span>(diffValue &lt; <span class=hljs-number>0</span>) { <span class=hljs-keyword>return</span>; }
    <span class=hljs-keyword>let</span> monthC = diffValue / month
      <span class=hljs-keyword>let</span> weekC = diffValue / (<span class=hljs-number>7</span> * day)
      <span class=hljs-keyword>let</span> dayC = diffValue / day
      <span class=hljs-keyword>let</span> hourC = diffValue / hour
      <span class=hljs-keyword>let</span> minC = diffValue / minute
      <span class=hljs-keyword>if</span>(monthC>= <span class=hljs-number>1</span>){
    result = <span class=hljs-string>""</span> + <span class=hljs-built_in>parseInt</span>(monthC) + <span class=hljs-string>"月前"</span>
    }
      <span class=hljs-keyword>else</span> <span class=hljs-keyword>if</span> (weekC >= <span class=hljs-number>1</span>) {
      result = <span class=hljs-string>""</span> + <span class=hljs-built_in>parseInt</span>(weekC) + <span class=hljs-string>"周前"</span>
    }
    <span class=hljs-keyword>else</span> <span class=hljs-keyword>if</span> (dayC >= <span class=hljs-number>1</span>) {
      result = <span class=hljs-string>""</span> + <span class=hljs-built_in>parseInt</span>(dayC) + <span class=hljs-string>"天前"</span>
    }
    <span class=hljs-keyword>else</span> <span class=hljs-keyword>if</span> (hourC >= <span class=hljs-number>1</span>) {
      result = <span class=hljs-string>""</span> + <span class=hljs-built_in>parseInt</span>(hourC) + <span class=hljs-string>"小时前"</span>
    }
    <span class=hljs-keyword>else</span> <span class=hljs-keyword>if</span> (minC >= <span class=hljs-number>1</span>) {
      result = <span class=hljs-string>""</span> + <span class=hljs-built_in>parseInt</span>(minC) + <span class=hljs-string>"分钟前"</span>
    } <span class=hljs-keyword>else</span>
      result = <span class=hljs-string>"刚刚"</span>
    <span class=hljs-keyword>return</span> result
  },</code></pre> <h3 id=最后>最后</h3> <p>相关思路适用于所有mvvm框架。</p> </div> <div class=my-8 id=vcomments></div> </main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"2018\u002F10\u002Fmp-countdown.md",path:"2018\u002F10\u002Fmp-countdown",slug:"2018_10_mp-countdown",html:"\u003Ch3 id=\"写在前\"\u003E写在前\u003C\u002Fh3\u003E\n\u003Cp\u003E最近由于业务需要，需要做一个倒计时的小插件，想想自己在很久以前用JavaScript写过，操作dom，很快就可以修改对应的数字了。现在换到小程序后，主要的还是去更改data的值，进而修改对应的图片。  \u003C\u002Fp\u003E\n\u003C!--more--\u003E\n\n\u003Ch3 id=\"效果\"\u003E效果\u003C\u002Fh3\u003E\n\u003Cp\u003E\u003Cimg align=\"center\" style=\"width: 100%;\" data-zoomable src=\"https:\u002F\u002Fimages.vrm.cn\u002F2018\u002F11\u002F22\u002F微信截图_20181122151328.png\" alt=\"counter\" \u003E\n具体：  \u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E精度为天时分秒\u003C\u002Fli\u003E\n\u003Cli\u003E初始时间可以从接口获取\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch3 id=\"代码\"\u003E代码\u003C\u002Fh3\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-html\"\u003E  \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eview\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"counter\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n    距离活动结束仅剩\n    \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebindload\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"showPicture\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"clock\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Emode\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"widthFix\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.dayBegin}}.png\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebindload\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"showPicture\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"clock\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Emode\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"widthFix\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.dayEnd}}.png\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n    天\n    \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebindload\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"showPicture\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"clock\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Emode\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"widthFix\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.hourBegin}}.png\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebindload\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"showPicture\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"clock\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Emode\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"widthFix\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.hourEnd}}.png\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n    时\n    \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebindload\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"showPicture\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"clock\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Emode\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"widthFix\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.minuteBegin}}.png\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebindload\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"showPicture\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"clock\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Emode\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"widthFix\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.minuteEnd}}.png\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n    分\n    \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebindload\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"showPicture\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"clock\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Emode\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"widthFix\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.secondBegin}}.png\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-tag\"\u003E&lt;\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Ebindload\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"showPicture\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"clock\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Emode\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"widthFix\"\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-attr\"\u003Esrc\u003C\u002Fspan\u003E=\u003Cspan class=\"hljs-string\"\u003E\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.secondEnd}}.png\"\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eimage\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\n    秒\n  \u003Cspan class=\"hljs-tag\"\u003E&lt;\u002F\u003Cspan class=\"hljs-name\"\u003Eview\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 初始值\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-attr\"\u003Etimer\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Enull\u003C\u002Fspan\u003E,\n\u003Cspan class=\"hljs-attr\"\u003Edata\u003C\u002Fspan\u003E: {\n  \u003Cspan class=\"hljs-attr\"\u003Ecount\u003C\u002Fspan\u003E: {\n    \u003Cspan class=\"hljs-attr\"\u003EexpireDate\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E172800\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F s\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-attr\"\u003EdayBegin\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003EdayEnd\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003EhourBegin\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003EhourEnd\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003EminuteBegin\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003EminuteEnd\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003EsecondBegin\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003EsecondEnd\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E\n  }\n}\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 接口回调处\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E { count } = \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.data\ndelele count[\u003Cspan class=\"hljs-string\"\u003E`expireDate`\u003C\u002Fspan\u003E] \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 删除原count中的expireDate\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.setData({\n  ...count,\n  \u003Cspan class=\"hljs-attr\"\u003EexpireDate\u003C\u002Fspan\u003E: newExpireDate\n})\n\u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.timer = setInterval(\u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003E\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E expireDate = \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.data.count.expireDate - \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.setData({\n    \u003Cspan class=\"hljs-attr\"\u003Ecount\u003C\u002Fspan\u003E: {\n      \u003Cspan class=\"hljs-attr\"\u003EdayBegin\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.convertTime(expireDate)[\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E][\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E],\n      \u003Cspan class=\"hljs-attr\"\u003EdayEnd\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.convertTime(expireDate)[\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E][\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E],\n      \u003Cspan class=\"hljs-attr\"\u003EhourBegin\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.convertTime(expireDate)[\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E][\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E],\n      \u003Cspan class=\"hljs-attr\"\u003EhourEnd\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.convertTime(expireDate)[\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E][\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E],\n      \u003Cspan class=\"hljs-attr\"\u003EminuteBegin\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.convertTime(expireDate)[\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E][\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E],\n      \u003Cspan class=\"hljs-attr\"\u003EminuteEnd\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.convertTime(expireDate)[\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E][\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E],\n      \u003Cspan class=\"hljs-attr\"\u003EsecondBegin\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.convertTime(expireDate)[\u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E][\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E],\n      \u003Cspan class=\"hljs-attr\"\u003EsecondEnd\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.convertTime(expireDate)[\u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E][\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E],\n      expireDate,\n    }\n  })\n}, \u003Cspan class=\"hljs-number\"\u003E1000\u003C\u002Fspan\u003E)\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F**\n * 时间转化函数，时间戳入参为秒\n*\u002F\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-attr\"\u003EconvertTime\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-params\"\u003Esec\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E time\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (sec &gt; \u003Cspan class=\"hljs-number\"\u003E-1\u003C\u002Fspan\u003E) {\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E hour = \u003Cspan class=\"hljs-built_in\"\u003EMath\u003C\u002Fspan\u003E.floor(sec \u002F \u003Cspan class=\"hljs-number\"\u003E3600\u003C\u002Fspan\u003E)\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E min = \u003Cspan class=\"hljs-built_in\"\u003EMath\u003C\u002Fspan\u003E.floor(sec \u002F \u003Cspan class=\"hljs-number\"\u003E60\u003C\u002Fspan\u003E) % \u003Cspan class=\"hljs-number\"\u003E60\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E second = sec % \u003Cspan class=\"hljs-number\"\u003E60\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E day = \u003Cspan class=\"hljs-built_in\"\u003EparseInt\u003C\u002Fspan\u003E(hour \u002F \u003Cspan class=\"hljs-number\"\u003E24\u003C\u002Fspan\u003E)\n    hour = hour - \u003Cspan class=\"hljs-number\"\u003E24\u003C\u002Fspan\u003E * day\n    hour = hour &lt; \u003Cspan class=\"hljs-number\"\u003E10\u003C\u002Fspan\u003E ? \u003Cspan class=\"hljs-string\"\u003E`0\u003Cspan class=\"hljs-subst\"\u003E${hour}\u003C\u002Fspan\u003E`\u003C\u002Fspan\u003E : hour\n    time = day &lt; \u003Cspan class=\"hljs-number\"\u003E10\u003C\u002Fspan\u003E ? \u003Cspan class=\"hljs-string\"\u003E`0\u003Cspan class=\"hljs-subst\"\u003E${day}\u003C\u002Fspan\u003E:\u003Cspan class=\"hljs-subst\"\u003E${hour}\u003C\u002Fspan\u003E:`\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E`\u003Cspan class=\"hljs-subst\"\u003E${day}\u003C\u002Fspan\u003E:\u003Cspan class=\"hljs-subst\"\u003E${hour}\u003C\u002Fspan\u003E:`\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (min &lt; \u003Cspan class=\"hljs-number\"\u003E10\u003C\u002Fspan\u003E) {\n      time += \u003Cspan class=\"hljs-string\"\u003E\"0\"\u003C\u002Fspan\u003E\n    }\n    time += min + \u003Cspan class=\"hljs-string\"\u003E\":\"\u003C\u002Fspan\u003E;\n    \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (second &lt; \u003Cspan class=\"hljs-number\"\u003E10\u003C\u002Fspan\u003E) {\n      time += \u003Cspan class=\"hljs-string\"\u003E\"0\"\u003C\u002Fspan\u003E\n    }\n    time += second\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E time.split(\u003Cspan class=\"hljs-string\"\u003E':'\u003C\u002Fspan\u003E) \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 返回一个包含天时分秒的数组\u003C\u002Fspan\u003E\n  }\n}\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 最后不要忘记在周期销毁处清空计时器\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-attr\"\u003EonUnload\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-params\"\u003E\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n  clearInterval(\u003Cspan class=\"hljs-keyword\"\u003Ethis\u003C\u002Fspan\u003E.timer)\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 时间转 **前的函数\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003EgetDateDiff\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-params\"\u003EdateTimeStamp\u003C\u002Fspan\u003E)\u003C\u002Fspan\u003E{\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E result = \u003Cspan class=\"hljs-string\"\u003E''\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E minute = \u003Cspan class=\"hljs-number\"\u003E1000\u003C\u002Fspan\u003E * \u003Cspan class=\"hljs-number\"\u003E60\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E hour = minute * \u003Cspan class=\"hljs-number\"\u003E60\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E day = hour * \u003Cspan class=\"hljs-number\"\u003E24\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E halfamonth = day * \u003Cspan class=\"hljs-number\"\u003E15\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E month = day * \u003Cspan class=\"hljs-number\"\u003E30\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E now = \u003Cspan class=\"hljs-keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-built_in\"\u003EDate\u003C\u002Fspan\u003E().getTime()\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E diffValue = now - dateTimeStamp\n    \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E(diffValue &lt; \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E) { \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E; }\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E monthC = diffValue \u002F month\n      \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E weekC = diffValue \u002F (\u003Cspan class=\"hljs-number\"\u003E7\u003C\u002Fspan\u003E * day)\n      \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E dayC = diffValue \u002F day\n      \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E hourC = diffValue \u002F hour\n      \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E minC = diffValue \u002F minute\n      \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E(monthC&gt;= \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E){\n    result = \u003Cspan class=\"hljs-string\"\u003E\"\"\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-built_in\"\u003EparseInt\u003C\u002Fspan\u003E(monthC) + \u003Cspan class=\"hljs-string\"\u003E\"月前\"\u003C\u002Fspan\u003E\n    }\n      \u003Cspan class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (weekC &gt;= \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E) {\n      result = \u003Cspan class=\"hljs-string\"\u003E\"\"\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-built_in\"\u003EparseInt\u003C\u002Fspan\u003E(weekC) + \u003Cspan class=\"hljs-string\"\u003E\"周前\"\u003C\u002Fspan\u003E\n    }\n    \u003Cspan class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (dayC &gt;= \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E) {\n      result = \u003Cspan class=\"hljs-string\"\u003E\"\"\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-built_in\"\u003EparseInt\u003C\u002Fspan\u003E(dayC) + \u003Cspan class=\"hljs-string\"\u003E\"天前\"\u003C\u002Fspan\u003E\n    }\n    \u003Cspan class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (hourC &gt;= \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E) {\n      result = \u003Cspan class=\"hljs-string\"\u003E\"\"\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-built_in\"\u003EparseInt\u003C\u002Fspan\u003E(hourC) + \u003Cspan class=\"hljs-string\"\u003E\"小时前\"\u003C\u002Fspan\u003E\n    }\n    \u003Cspan class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (minC &gt;= \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E) {\n      result = \u003Cspan class=\"hljs-string\"\u003E\"\"\u003C\u002Fspan\u003E + \u003Cspan class=\"hljs-built_in\"\u003EparseInt\u003C\u002Fspan\u003E(minC) + \u003Cspan class=\"hljs-string\"\u003E\"分钟前\"\u003C\u002Fspan\u003E\n    } \u003Cspan class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E\n      result = \u003Cspan class=\"hljs-string\"\u003E\"刚刚\"\u003C\u002Fspan\u003E\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E result\n  },\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3 id=\"最后\"\u003E最后\u003C\u002Fh3\u003E\n\u003Cp\u003E相关思路适用于所有mvvm框架。\u003C\u002Fp\u003E\n",fmData:{attributes:{title:"用小程序做个动态倒计时",description:"最近由于业务需要，需要做一个倒计时的小插件，想想自己在很久以前用JavaScript写过，操作dom，很快就可以修改对应的数字了。现在换到小程序后，主要的还是去更改data的值，进而修改对应的图片。",keywords:"小程序,倒计时,编写",labels:["小程序"],date:"2018-10-15T00:00:00.000Z"},body:"### 写在前\n\n最近由于业务需要，需要做一个倒计时的小插件，想想自己在很久以前用JavaScript写过，操作dom，很快就可以修改对应的数字了。现在换到小程序后，主要的还是去更改data的值，进而修改对应的图片。  \n\n\u003C!--more--\u003E\n\n### 效果\n\n![counter](https:\u002F\u002Fimages.vrm.cn\u002F2018\u002F11\u002F22\u002F微信截图_20181122151328.png)\n具体：  \n\n- 精度为天时分秒\n- 初始时间可以从接口获取\n\n### 代码\n```html\n  \u003Cview class=\"counter\"\u003E\n    距离活动结束仅剩\n    \u003Cimage bindload=\"showPicture\" class=\"clock\" mode=\"widthFix\" src=\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.dayBegin}}.png\"\u003E\u003C\u002Fimage\u003E\n    \u003Cimage bindload=\"showPicture\" class=\"clock\" mode=\"widthFix\" src=\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.dayEnd}}.png\"\u003E\u003C\u002Fimage\u003E\n    天\n    \u003Cimage bindload=\"showPicture\" class=\"clock\" mode=\"widthFix\" src=\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.hourBegin}}.png\"\u003E\u003C\u002Fimage\u003E\n    \u003Cimage bindload=\"showPicture\" class=\"clock\" mode=\"widthFix\" src=\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.hourEnd}}.png\"\u003E\u003C\u002Fimage\u003E\n    时\n    \u003Cimage bindload=\"showPicture\" class=\"clock\" mode=\"widthFix\" src=\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.minuteBegin}}.png\"\u003E\u003C\u002Fimage\u003E\n    \u003Cimage bindload=\"showPicture\" class=\"clock\" mode=\"widthFix\" src=\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.minuteEnd}}.png\"\u003E\u003C\u002Fimage\u003E\n    分\n    \u003Cimage bindload=\"showPicture\" class=\"clock\" mode=\"widthFix\" src=\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.secondBegin}}.png\"\u003E\u003C\u002Fimage\u003E\n    \u003Cimage bindload=\"showPicture\" class=\"clock\" mode=\"widthFix\" src=\"..\u002F..\u002Fsrc\u002Fimages\u002Fclock\u002Fnum{{count.secondEnd}}.png\"\u003E\u003C\u002Fimage\u003E\n    秒\n  \u003C\u002Fview\u003E\n```\n```javascript\n\u002F\u002F 初始值\ntimer: null,\ndata: {\n  count: {\n    expireDate: 172800, \u002F\u002F s\n    dayBegin: 0,\n    dayEnd: 0,\n    hourBegin: 0,\n    hourEnd: 0,\n    minuteBegin: 0,\n    minuteEnd: 0,\n    secondBegin: 0,\n    secondEnd: 0\n  }\n}\n\n\u002F\u002F 接口回调处\nlet { count } = this.data\ndelele count[`expireDate`] \u002F\u002F 删除原count中的expireDate\nthis.setData({\n  ...count,\n  expireDate: newExpireDate\n})\nthis.timer = setInterval(function() {\n  let expireDate = this.data.count.expireDate - 1\n  this.setData({\n    count: {\n      dayBegin: this.convertTime(expireDate)[0][0],\n      dayEnd: this.convertTime(expireDate)[0][1],\n      hourBegin: this.convertTime(expireDate)[1][0],\n      hourEnd: this.convertTime(expireDate)[1][1],\n      minuteBegin: this.convertTime(expireDate)[2][0],\n      minuteEnd: this.convertTime(expireDate)[2][1],\n      secondBegin: this.convertTime(expireDate)[3][0],\n      secondEnd: this.convertTime(expireDate)[3][1],\n      expireDate,\n    }\n  })\n}, 1000)\n\n\u002F**\n * 时间转化函数，时间戳入参为秒\n*\u002F\nconvertTime: function (sec) {\n  let time\n  if (sec \u003E -1) {\n    let hour = Math.floor(sec \u002F 3600)\n    let min = Math.floor(sec \u002F 60) % 60\n    let second = sec % 60\n    let day = parseInt(hour \u002F 24)\n    hour = hour - 24 * day\n    hour = hour \u003C 10 ? `0${hour}` : hour\n    time = day \u003C 10 ? `0${day}:${hour}:`: `${day}:${hour}:`\n    if (min \u003C 10) {\n      time += \"0\"\n    }\n    time += min + \":\";\n    if (second \u003C 10) {\n      time += \"0\"\n    }\n    time += second\n    return time.split(':') \u002F\u002F 返回一个包含天时分秒的数组\n  }\n}\n\u002F\u002F 最后不要忘记在周期销毁处清空计时器\nonUnload: function () {\n  clearInterval(this.timer)\n}\n```\n```javascript\n\u002F\u002F 时间转 **前的函数\n  getDateDiff: function(dateTimeStamp){\n    let result = ''\n    let minute = 1000 * 60\n    let hour = minute * 60\n    let day = hour * 24\n    let halfamonth = day * 15\n    let month = day * 30\n    let now = new Date().getTime()\n    let diffValue = now - dateTimeStamp\n    if(diffValue \u003C 0) { return; }\n    let monthC = diffValue \u002F month\n      let weekC = diffValue \u002F (7 * day)\n      let dayC = diffValue \u002F day\n      let hourC = diffValue \u002F hour\n      let minC = diffValue \u002F minute\n      if(monthC\u003E= 1){\n    result = \"\" + parseInt(monthC) + \"月前\"\n    }\n      else if (weekC \u003E= 1) {\n      result = \"\" + parseInt(weekC) + \"周前\"\n    }\n    else if (dayC \u003E= 1) {\n      result = \"\" + parseInt(dayC) + \"天前\"\n    }\n    else if (hourC \u003E= 1) {\n      result = \"\" + parseInt(hourC) + \"小时前\"\n    }\n    else if (minC \u003E= 1) {\n      result = \"\" + parseInt(minC) + \"分钟前\"\n    } else\n      result = \"刚刚\"\n    return result\n  },\n```\n### 最后\n相关思路适用于所有mvvm框架。",bodyBegin:9,frontmatter:"title: 用小程序做个动态倒计时 \ndescription: 最近由于业务需要，需要做一个倒计时的小插件，想想自己在很久以前用JavaScript写过，操作dom，很快就可以修改对应的数字了。现在换到小程序后，主要的还是去更改data的值，进而修改对应的图片。 \nkeywords: 小程序,倒计时,编写\nlabels: ['小程序']\ndate: 2018-10-15"}}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.19b6d283.js"}catch(e){main="/client/legacy/client.4e6474e3.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170295070-1"></script> <script> window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-170295070-1'); </script> 